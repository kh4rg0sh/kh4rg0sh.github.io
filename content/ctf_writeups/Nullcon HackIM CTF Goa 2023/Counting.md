---
linkTitle: Counting
title: Counting [Writeup]
type: docs
math: True
---
## Challenge Description

```
"I heard it is in fashion to have a counter since the last incident happened."
```

## Solution
The setup is clearly vulnerable to Franklin-Reiter's attack because we have access to ciphertexts that have a finite constant difference between their plaintext messages. From the following script we can find the secret token. 
```python
from sage.all import *
def compositeModulusGCD(a, b):
    if(b == 0):
        return a.monic()
    else:
        return compositeModulusGCD(b, a % b)
def franklinreiter(C1, C2, e, N, a, b):
    x=var('x')
    P = PolynomialRing(Zmod(N),'x')
    gt = a*x + b
    g1 = gt**e - C1
    g2 = x**e - C2
    result = (g1.gcd(g2).coefficients()[0])
    return result
n = 23346864641775135920342683759291067963163772942773308271703099060710413033864481347422098545892696977611932834271295923624466244485288124286513088420414541941384059046912277491270910671335171485310551406049026960803455309802781918134999947913522862009982210925698757778943778254672625452054433259624196304744059442959896711646003841712330244214385219834237537806298533911428744945431606858645010106262556782430228374058268126652399552199171240232565007737391063918608581114239667213495923409397526670860318496015009877207354795886846151279625628512620383849393254056209705916747370652858216859849090288306725458465713
c1 = 5390873336696770499863738064454099629750307690604498397482384952635354976370646962103592174554782442774972636647326721023583942357590609046031691451862593837913348860208415265022628976422090980128578405561603058795408336484451372856600427950574826877436297167027426994052252706079357923629982654698049602565955834717877078281383743452850130796563596961478150737001932442769406611953318998982855333341863117265543896215394478478724650672784569336865243464952090160837560359689798931413538544545266082057437155014071402521667226035188114186901721786854094047461672987974786367938328148862792963925275572485514641747822
c2 = 2018115153376399458061638758898268103529712993646898389562521655366944191753938071967951044760004571520241982280984905339262602363210731257048343440551105584394867593187622084376676680627362864435285943399390109011813972331788670658224518211316210692242094013941517353551391169860896276808310155175606364743718107637109657889780951339209063480488856893226751239692106172871110781341826172447156490108797956695175165816141847505085601917730091481586951673398235006712588670041928054616277484635128806318164131653585140763206166024961647421751004333396447453251727515820792863760404605412404184613836986251050977461299
e = 1337
for i in range(0,2048):
    print(i,end=" ")
    print(franklinreiter(c1,c2,e,n,1,1<<i))
```

which occurs when $i=552$. We can take that secret token and send it back to receive the flag. Here's a script using the pwn library to do it.

```python
from sage.all import *
from Cryptodome.Util.number import long_to_bytes, bytes_to_long, getPrime, inverse
import sys
import threading
import multiprocessing
from pwn import *
sys.setrecursionlimit(10000)

n = 23346864641775135920342683759291067963163772942773308271703099060710413033864481347422098545892696977611932834271295923624466244485288124286513088420414541941384059046912277491270910671335171485310551406049026960803455309802781918134999947913522862009982210925698757778943778254672625452054433259624196304744059442959896711646003841712330244214385219834237537806298533911428744945431606858645010106262556782430228374058268126652399552199171240232565007737391063918608581114239667213495923409397526670860318496015009877207354795886846151279625628512620383849393254056209705916747370652858216859849090288306725458465713
c1 = 5390873336696770499863738064454099629750307690604498397482384952635354976370646962103592174554782442774972636647326721023583942357590609046031691451862593837913348860208415265022628976422090980128578405561603058795408336484451372856600427950574826877436297167027426994052252706079357923629982654698049602565955834717877078281383743452850130796563596961478150737001932442769406611953318998982855333341863117265543896215394478478724650672784569336865243464952090160837560359689798931413538544545266082057437155014071402521667226035188114186901721786854094047461672987974786367938328148862792963925275572485514641747822
c2 = 2018115153376399458061638758898268103529712993646898389562521655366944191753938071967951044760004571520241982280984905339262602363210731257048343440551105584394867593187622084376676680627362864435285943399390109011813972331788670658224518211316210692242094013941517353551391169860896276808310155175606364743718107637109657889780951339209063480488856893226751239692106172871110781341826172447156490108797956695175165816141847505085601917730091481586951673398235006712588670041928054616277484635128806318164131653585140763206166024961647421751004333396447453251727515820792863760404605412404184613836986251050977461299
e = 1337
a1 = 1
a2 = 1
b1 = 0
check_data = b'\xb8\xf1Z\xd9\x88\x8b\xbb\x17o\x82\xcf2\xa3g\xa3\xdd\x8dx\x11\xe1\xa2\xaa\x02\x85\x1b|\x9b\x07|\xd51\x90-\xf1\x90\xcf\x14K[~\x8anO\xda\xce\x0ei_=\x16\x15\x9188\xc11A\xe4\x13\x84\xd7\x9f\xd5\xd0\xf1t\xac\xfb>\xf3\xdc\xf4/\xe5\x7f\x0cW\xf3z]\x91\x022\x83k\x8bu\xd7\x82\x84+\xce1\x90\xba\xe6m\x8b\xc73\x8b+\x04\xe4\xed\xd6\xfa\xdd\x19\xe8\xa1"\xbd\n\xbb"\xccW\xe7\xa1@\xef\x9a\x1a\x97\x0f\x87\xc9h4\xa9q\x15\xc4\xde8\r\x1c\x98S\x81\x16\xed\x01\xf9+\xd0\xad\xe9q\xfd\xa5Z\xce\xb6\x15h\xc7\x17\xe2\x80/\x9cIBRK\x10\xf5#\xf0|\xed\x06\xa3\xd3\xe7\xac\xde\xb3\xa1\xa6m@\xa2D\x11\x85|\x8f\xf2\xbe\xb6\x07 \xb5\xa8"8wL\xe4\x9f\xd0\x06\x89Y\x17 \x80H"\xe6\x9c;\xc8\x04\x0c\xa6\xb0\xda\x03?5/\xda\xc3\xf6\t^\xd8\x1a\x82"\xeb\xea\xdf\xea\xff\x14\xdb\xff(\xdd\x03\xff8\xcb\x84W\x9f\xc2\x1a\x16\xd3\xb0'
def compositeModulusGCD(a, b):
    if(b == 0):
            return a.monic()
    else:
            return compositeModulusGCD(b, a % b)

def FranklinReiter(n, e, c1, c2, a1, a2, b1, b2):
    x = var('x')
    P = PolynomialRing(Zmod(n),'x')
    f = (a1*P('x')+b1)**e - c1
    g = (a2*P('x')+b2)**e - c2
    m =  Integer(n-(compositeModulusGCD(f,g)).coefficients()[0])
    data = long_to_bytes(m)
    return data
def attack(i):
    for k in range(i,i+50):
        FranklinReiter(n, e, c1, c2, a1, a2, b1, 1<<k)
        print(k)
        print()
# k = 552 

p = remote("52.59.124.14", 10008)
p.recvline()
n = int(p.recvline().strip().decode())
p.recvline()
c1 = int(p.recvline().strip().decode())
p.recvline()
p.sendline(b'0')

c2 = int(p.recvline().strip().decode())

# threads=[]
# for j in range(1, 20):
#     t=multiprocessing.Process(target=attack, args=[50*j])
#     t.start()
#     threads.append(t)
# for thread in threads:
#     thread.join()

data = FranklinReiter(n, e, c1, c2, a1, a2, b1, 1<<552)
#print(data)
data = data.lstrip(b"So far we had 000 failed attempts to find the token ")

p.recvline()
p.sendline(data)
p.interactive()
```
## Flag
```
ENO{th3_s0lut1on_i5_n0t_th4t_1337}
```
